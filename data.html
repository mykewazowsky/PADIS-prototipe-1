<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PADIS - Data</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <div class="sidebar">
            <h2><i class="fas fa-seedling"></i> PADIS</h2>
            <ul>
                <li><a href="index.html"><i class="fas fa-home"></i> Overview</a></li>
                <li><a href="#data"><i class="fas fa-chart-bar"></i> Data Analysis</a></li>
                <li><a href="map.html"><i class="fas fa-map"></i> GIS Map</a></li>
                <li><a href="about.html"><i class="fas fa-info-circle"></i> About</a></li>
            </ul>
        </div>
        <div class="main-content">
            <section id="data" class="fade-in">
                <h1>Data Analysis</h1>
                <p>Comprehensive data visualizations and statistical insights for agricultural loss assessment.</p>

                <div class="grid">
                    <div class="card">
                        <h3><i class="fas fa-chart-bar"></i> Loss Distribution</h3>
                        <div class="filter-controls">
                            <div class="filter-item">
                                <label for="lossRegionFilter">Select Region:</label>
                                <select id="lossRegionFilter">
                                    <option value="West Java" selected="selected">West Java</option>
                                    <option value="Central Java">Central Java</option>
                                    <option value="East Java">East Java</option>
                                    <option value="Yogyakarta">Yogyakarta</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-container bar-chart-container">
                            <canvas id="pieChart"></canvas>
                        </div>
                        <button class="generate-report-btn" onclick="generatePieReport()">Generate Report</button>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-chart-line"></i> Trend Analysis</h3>
                        <div class="filter-controls">
                            <div class="filter-item">
                                <label for="lineRegionFilter">Select Region:</label>
                                <select id="lineRegionFilter">
                                    <option value="West Java" selected="selected">West Java</option>
                                    <option value="Central Java">Central Java</option>
                                    <option value="East Java">East Java</option>
                                    <option value="Yogyakarta">Yogyakarta</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-container line-chart-container">
                            <canvas id="lineChart"></canvas>
                        </div>
                        <button class="generate-report-btn" onclick="generateLineReport()">Generate Report</button>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-chart-bar"></i> Regional Comparison</h3>
                        <div class="filter-controls">
                            <div class="filter-item">
                                <label for="region1Filter">Region 1:</label>
                                <select id="region1Filter">
                                    <option value="">Select Region</option>
                                    <option value="West Java" selected="selected">West Java</option>
                                    <option value="Central Java">Central Java</option>
                                    <option value="East Java">East Java</option>
                                    <option value="Yogyakarta">Yogyakarta</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="region2Filter">Region 2:</label>
                                <select id="region2Filter">
                                    <option value="">Select Region</option>
                                    <option value="West Java">West Java</option>
                                    <option value="Central Java" selected="selected">Central Java</option>
                                    <option value="East Java">East Java</option>
                                    <option value="Yogyakarta">Yogyakarta</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="region3Filter">Region 3:</label>
                                <select id="region3Filter">
                                    <option value="">Select Region</option>
                                    <option value="West Java">West Java</option>
                                    <option value="Central Java">Central Java</option>
                                    <option value="East Java" selected="selected">East Java</option>
                                    <option value="Yogyakarta">Yogyakarta</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="hazardFilter">Select Hazard:</label>
                                <select id="hazardFilter">
                                    <option value="Flood" selected>Flood</option>
                                    <option value="Drought">Drought</option>
                                    <option value="Multi-Hazard">Multi-Hazard</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-container bar-chart-container">
                            <canvas id="barChart"></canvas>
                        </div>
                        <button class="generate-report-btn" onclick="generateBarReport()">Generate Report</button>
                    </div>
                    <div class="card">
                        <h3><i class="fas fa-table"></i> Data Summary</h3>
                        <div class="filter-controls">
                            <div class="filter-item">
                                <label for="tableHazardFilter">Select Hazard:</label>
                                <select id="tableHazardFilter">
                                    <option value="Flood">Flood</option>
                                    <option value="Drought">Drought</option>
                                    <option value="Multi-Hazard">Multi-Hazard</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="scenarioFilter">Select Scenario:</label>
                                <select id="scenarioFilter">
                                    <option value="all" selected>All</option>
                                    <option value="climate">Climate</option>
                                    <option value="non-climate">Non-Climate</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="returnPeriodFilter">Select Return Period:</label>
                                <select id="returnPeriodFilter">
                                    <option value="all" selected>All</option>
                                    <option value="25">25 years</option>
                                    <option value="50">50 years</option>
                                    <option value="100">100 years</option>
                                    <option value="250">250 years</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="itemsPerPage">Items per page:</label>
                                <select id="itemsPerPage">
                                    <option value="10" selected>10</option>
                                    <option value="15">15</option>
                                    <option value="25">25</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-container">
                            <table id="data-summary-table">
                                <thead>
                                    <tr>
                                        <th>Region</th>
                                        <th>Percentage <button class="sort-btn" data-column="percentage" data-order="asc"><i class="fas fa-sort-up"></i></button> <button class="sort-btn" data-column="percentage" data-order="desc"><i class="fas fa-sort-down"></i></button></th>
                                        <th>IDR Loss <button class="sort-btn" data-column="loss" data-order="asc"><i class="fas fa-sort-up"></i></button> <button class="sort-btn" data-column="loss" data-order="desc"><i class="fas fa-sort-down"></i></button></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Table will be populated dynamically from GeoJSON data -->
                                </tbody>
                            </table>
                        </div>
                        <div id="pagination" style="margin-top: 1rem; text-align: center;"></div>
                        <button class="generate-report-btn" onclick="generateTableReport()">Generate Report</button>
                    </div>
                </div>


            </section>
        </div>
    </div>



    <script src="script.js"></script>
    <script>
        let tableData = [];
        let currentPage = 1;
        let itemsPerPage = 10;

        document.addEventListener('DOMContentLoaded', function() {
            fetch('data/jawa-loss-prototipe.geojson')
                .then(response => response.json())
                .then(data => {
                    const regionLosses = {};
                    let totalLoss = 0;

                    data.features.forEach(feature => {
                        const region = feature.properties.NAMOBJ || 'Unknown';
                        const loss = feature.properties.VALUE || feature.properties._majority || 0;
                        if (!regionLosses[region]) {
                            regionLosses[region] = 0;
                        }
                        regionLosses[region] += loss;
                        totalLoss += loss;
                    });

                    tableData = Object.keys(regionLosses).map(region => {
                        const loss = regionLosses[region];
                        const percentage = totalLoss > 0 ? ((loss / totalLoss) * 100).toFixed(1) : '0.0';
                        return {
                            region,
                            percentage: parseFloat(percentage),
                            loss: parseFloat(loss.toFixed(1))
                        };
                    });

                    renderTable();
                    renderPagination();

                    // Add event listeners to sort buttons
                    document.querySelectorAll('.sort-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            const column = this.getAttribute('data-column');
                            const order = this.getAttribute('data-order');
                            sortTable(column, order);
                        });
                    });

                    // Add event listener for items per page selector
                    document.getElementById('itemsPerPage').addEventListener('change', function() {
                        itemsPerPage = parseInt(this.value);
                        currentPage = 1; // Reset to first page
                        renderTable();
                        renderPagination();
                    });
                })
                .catch(error => console.log('Error loading GeoJSON:', error));
        });

        function sortTable(column, order) {
            tableData.sort((a, b) => {
                if (order === 'asc') {
                    return a[column] - b[column];
                } else {
                    return b[column] - a[column];
                }
            });
            currentPage = 1; // Reset to first page after sorting
            renderTable();
            renderPagination();
        }

        function renderTable() {
            const tableBody = document.querySelector('#data-summary-table tbody');
            tableBody.innerHTML = '';

            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = tableData.slice(startIndex, endIndex);

            pageData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.region}</td>
                    <td>${item.percentage.toFixed(1)}</td>
                    <td>${item.loss.toFixed(1)}B</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function renderPagination() {
            const paginationContainer = document.querySelector('#pagination');
            paginationContainer.innerHTML = '';

            const totalPages = Math.ceil(tableData.length / itemsPerPage);

            if (totalPages <= 1) return;

            const prevBtn = document.createElement('button');
            prevBtn.textContent = 'Previous';
            prevBtn.className = 'btn small-btn';
            prevBtn.disabled = currentPage === 1;
            prevBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderTable();
                    renderPagination();
                }
            });
            paginationContainer.appendChild(prevBtn);

            const pageInfo = document.createElement('span');
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            pageInfo.style.margin = '0 1rem';
            paginationContainer.appendChild(pageInfo);

            const nextBtn = document.createElement('button');
            nextBtn.textContent = 'Next';
            nextBtn.className = 'btn small-btn';
            nextBtn.disabled = currentPage === totalPages;
            nextBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderTable();
                    renderPagination();
                }
            });
            paginationContainer.appendChild(nextBtn);
        }
    </script>
    <footer>
        Â© 2026 PADIS. All rights reserved.
    </footer>
</body>
</html>
