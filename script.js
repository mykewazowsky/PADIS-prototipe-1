    // Smooth scrolling is handled by CSS

// Fade-in animation on scroll
const sections = document.querySelectorAll('section');

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
        }
    });
}, { threshold: 0.1 });

sections.forEach(section => {
    section.style.opacity = '0';
    section.style.transform = 'translateY(50px)';
    section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
    observer.observe(section);
});

// Interactive button to change background color temporarily
function changeColor(sectionId) {
    const section = document.getElementById(sectionId);
    const originalBackground = section.style.background;
    section.style.background = 'linear-gradient(135deg, #ff0000 0%, #00ff00 100%)';
    setTimeout(() => {
        section.style.background = originalBackground;
    }, 2000);
}

// Edit item function for video and photo galleries
function editItem(button) {
    const item = button.parentElement;
    const title = item.querySelector('h3');
    const desc = item.querySelector('p');

    // Store original values
    const originalTitle = title.textContent;
    const originalDesc = desc.textContent;

    // Make editable
    title.contentEditable = true;
    desc.contentEditable = true;
    title.focus();

    // Change button to save/cancel
    button.textContent = 'Save';
    button.onclick = () => saveEdit(button, originalTitle, originalDesc);

    // Add cancel button
    const cancelBtn = document.createElement('button');
    cancelBtn.textContent = 'Cancel';
    cancelBtn.className = 'edit-btn';
    cancelBtn.onclick = () => cancelEdit(button, cancelBtn, title, desc, originalTitle, originalDesc);
    item.appendChild(cancelBtn);
}

function saveEdit(button, originalTitle, originalDesc) {
    const item = button.parentElement;
    const title = item.querySelector('h3');
    const desc = item.querySelector('p');
    const cancelBtn = item.querySelectorAll('.edit-btn')[1];

    // Make non-editable
    title.contentEditable = false;
    desc.contentEditable = false;

    // Restore button
    button.textContent = 'Edit';
    button.onclick = () => editItem(button);

    // Remove cancel button
    if (cancelBtn) cancelBtn.remove();
}

function cancelEdit(button, cancelBtn, title, desc, originalTitle, originalDesc) {
    // Restore original values
    title.textContent = originalTitle;
    desc.textContent = originalDesc;

    // Make non-editable
    title.contentEditable = false;
    desc.contentEditable = false;

    // Restore button
    button.textContent = 'Edit';
    button.onclick = () => editItem(button);

    // Remove cancel button
    cancelBtn.remove();
}

// Sample data for filters
const pieDataByYear = {
    '2019': [40, 30, 30],
    '2020': [45, 35, 20],
    '2021': [50, 30, 20],
    '2022': [48, 32, 20],
    '2023': [45, 35, 20]
};

const lineDataByRegion = {
    'West Java': [10, 12, 15, 18, 20],
    'Central Java': [8, 10, 12, 15, 18],
    'East Java': [15, 18, 20, 25, 28],
    'Yogyakarta': [5, 7, 9, 11, 13]
};

const barDataByYear = {
    '2019': [[14.2, 11.8, 17.5, 8.4], [7.7, 10.3, 5.9, 13.2], [21.9, 22.1, 23.4, 21.6]],
    '2020': [[15.2, 12.8, 18.5, 9.4], [8.7, 11.3, 6.9, 14.2], [23.9, 24.1, 25.4, 23.6]],
    '2021': [[16.2, 13.8, 19.5, 10.4], [9.7, 12.3, 7.9, 15.2], [25.9, 26.1, 27.4, 25.6]],
    '2022': [[17.2, 14.8, 20.5, 11.4], [10.7, 13.3, 8.9, 16.2], [27.9, 28.1, 29.4, 27.6]],
    '2023': [[15.2, 12.8, 18.5, 9.4], [8.7, 11.3, 6.9, 14.2], [23.9, 24.1, 25.4, 23.6]]
};

// Expanded data for pie chart with all filters
const pieData = {
    'West Java': {
        'Flood': {
            'Non-Iklim': {
                '25': {
                    '2019': [4.0, 3.0, 3.0],
                    '2020': [4.2, 3.2, 2.6],
                    '2021': [4.5, 3.5, 2.0],
                    '2022': [4.8, 3.2, 2.0],
                    '2023': [5.0, 3.0, 2.0]
                },
                '50': {
                    '2019': [4.5, 2.5, 3.0],
                    '2020': [4.7, 2.7, 2.6],
                    '2021': [5.0, 3.0, 2.0],
                    '2022': [5.3, 2.7, 2.0],
                    '2023': [5.5, 2.5, 2.0]
                },
                '100': {
                    '2019': [5.0, 2.0, 3.0],
                    '2020': [5.2, 2.2, 2.6],
                    '2021': [5.5, 2.5, 2.0],
                    '2022': [5.8, 2.2, 2.0],
                    '2023': [6.0, 2.0, 2.0]
                },
                '250': {
                    '2019': [5.5, 1.5, 3.0],
                    '2020': [5.7, 1.7, 2.6],
                    '2021': [6.0, 2.0, 2.0],
                    '2022': [6.3, 1.7, 2.0],
                    '2023': [6.5, 1.5, 2.0]
                }
            },
            'Iklim 4.5': {
                '25': {
                    '2019': [42, 28, 30],
                    '2020': [44, 30, 26],
                    '2021': [47, 33, 20],
                    '2022': [50, 30, 20],
                    '2023': [52, 28, 20]
                },
                '50': {
                    '2019': [47, 23, 30],
                    '2020': [49, 25, 26],
                    '2021': [52, 28, 20],
                    '2022': [55, 25, 20],
                    '2023': [57, 23, 20]
                },
                '100': {
                    '2019': [52, 18, 30],
                    '2020': [54, 20, 26],
                    '2021': [57, 23, 20],
                    '2022': [60, 20, 20],
                    '2023': [62, 18, 20]
                },
                '250': {
                    '2019': [57, 13, 30],
                    '2020': [59, 15, 26],
                    '2021': [62, 18, 20],
                    '2022': [65, 15, 20],
                    '2023': [67, 13, 20]
                }
            },
            'Iklim 8.5': {
                '25': {
                    '2019': [44, 26, 30],
                    '2020': [46, 28, 26],
                    '2021': [49, 31, 20],
                    '2022': [52, 28, 20],
                    '2023': [54, 26, 20]
                },
                '50': {
                    '2019': [49, 21, 30],
                    '2020': [51, 23, 26],
                    '2021': [54, 26, 20],
                    '2022': [57, 23, 20],
                    '2023': [59, 21, 20]
                },
                '100': {
                    '2019': [54, 16, 30],
                    '2020': [56, 18, 26],
                    '2021': [59, 21, 20],
                    '2022': [62, 18, 20],
                    '2023': [64, 16, 20]
                },
                '250': {
                    '2019': [59, 11, 30],
                    '2020': [61, 13, 26],
                    '2021': [64, 16, 20],
                    '2022': [67, 13, 20],
                    '2023': [69, 11, 20]
                }
            }
        },
        'Drought': {
            'Non-Iklim': {
                '25': {
                    '2019': [20, 40, 40],
                    '2020': [25, 35, 40],
                    '2021': [30, 30, 40],
                    '2022': [35, 25, 40],
                    '2023': [40, 20, 40]
                },
                '50': {
                    '2019': [25, 35, 40],
                    '2020': [30, 30, 40],
                    '2021': [35, 25, 40],
                    '2022': [40, 20, 40],
                    '2023': [45, 15, 40]
                },
                '100': {
                    '2019': [30, 30, 40],
                    '2020': [35, 25, 40],
                    '2021': [40, 20, 40],
                    '2022': [45, 15, 40],
                    '2023': [50, 10, 40]
                },
                '200': {
                    '2019': [35, 25, 40],
                    '2020': [40, 20, 40],
                    '2021': [45, 15, 40],
                    '2022': [50, 10, 40],
                    '2023': [55, 5, 40]
                }
            },
            'RCP 4.5': {
                '25': {
                    '2019': [22, 38, 40],
                    '2020': [27, 33, 40],
                    '2021': [32, 28, 40],
                    '2022': [37, 23, 40],
                    '2023': [42, 18, 40]
                },
                '50': {
                    '2019': [27, 33, 40],
                    '2020': [32, 28, 40],
                    '2021': [37, 23, 40],
                    '2022': [42, 18, 40],
                    '2023': [47, 13, 40]
                },
                '100': {
                    '2019': [32, 28, 40],
                    '2020': [37, 23, 40],
                    '2021': [42, 18, 40],
                    '2022': [47, 13, 40],
                    '2023': [52, 8, 40]
                },
                '200': {
                    '2019': [37, 23, 40],
                    '2020': [42, 18, 40],
                    '2021': [47, 13, 40],
                    '2022': [52, 8, 40],
                    '2023': [57, 3, 40]
                }
            },
            'RCP 8.5': {
                '25': {
                    '2019': [24, 36, 40],
                    '2020': [29, 31, 40],
                    '2021': [34, 26, 40],
                    '2022': [39, 21, 40],
                    '2023': [44, 16, 40]
                },
                '50': {
                    '2019': [29, 31, 40],
                    '2020': [34, 26, 40],
                    '2021': [39, 21, 40],
                    '2022': [44, 16, 40],
                    '2023': [49, 11, 40]
                },
                '100': {
                    '2019': [34, 26, 40],
                    '2020': [39, 21, 40],
                    '2021': [44, 16, 40],
                    '2022': [49, 11, 40],
                    '2023': [54, 6, 40]
                },
                '200': {
                    '2019': [39, 21, 40],
                    '2020': [44, 16, 40],
                    '2021': [49, 11, 40],
                    '2022': [54, 6, 40],
                    '2023': [59, 1, 40]
                }
            }
        }
    },
    'Central Java': {
        'Flood': {
            'Non-Iklim': {
                '25': {
                    '2019': [35, 35, 30],
                    '2020': [40, 30, 30],
                    '2021': [45, 25, 30],
                    '2022': [50, 20, 30],
                    '2023': [55, 15, 30]
                },
                '50': {
                    '2019': [40, 30, 30],
                    '2020': [45, 25, 30],
                    '2021': [50, 20, 30],
                    '2022': [55, 15, 30],
                    '2023': [60, 10, 30]
                },
                '100': {
                    '2019': [45, 25, 30],
                    '2020': [50, 20, 30],
                    '2021': [55, 15, 30],
                    '2022': [60, 10, 30],
                    '2023': [65, 5, 30]
                },
                '200': {
                    '2019': [50, 20, 30],
                    '2020': [55, 15, 30],
                    '2021': [60, 10, 30],
                    '2022': [65, 5, 30],
                    '2023': [70, 0, 30]
                }
            },
            'RCP 4.5': {
                '25': {
                    '2019': [37, 33, 30],
                    '2020': [42, 28, 30],
                    '2021': [47, 23, 30],
                    '2022': [52, 18, 30],
                    '2023': [57, 13, 30]
                },
                '50': {
                    '2019': [42, 28, 30],
                    '2020': [47, 23, 30],
                    '2021': [52, 18, 30],
                    '2022': [57, 13, 30],
                    '2023': [62, 8, 30]
                },
                '100': {
                    '2019': [47, 23, 30],
                    '2020': [52, 18, 30],
                    '2021': [57, 13, 30],
                    '2022': [62, 8, 30],
                    '2023': [67, 3, 30]
                },
                '200': {
                    '2019': [52, 18, 30],
                    '2020': [57, 13, 30],
                    '2021': [62, 8, 30],
                    '2022': [67, 3, 30],
                    '2023': [72, -2, 30]
                }
            },
            'RCP 8.5': {
                '25': {
                    '2019': [39, 31, 30],
                    '2020': [44, 26, 30],
                    '2021': [49, 21, 30],
                    '2022': [54, 16, 30],
                    '2023': [59, 11, 30]
                },
                '50': {
                    '2019': [44, 26, 30],
                    '2020': [49, 21, 30],
                    '2021': [54, 16, 30],
                    '2022': [59, 11, 30],
                    '2023': [64, 6, 30]
                },
                '100': {
                    '2019': [49, 21, 30],
                    '2020': [54, 16, 30],
                    '2021': [59, 11, 30],
                    '2022': [64, 6, 30],
                    '2023': [69, 1, 30]
                },
                '200': {
                    '2019': [54, 16, 30],
                    '2020': [59, 11, 30],
                    '2021': [64, 6, 30],
                    '2022': [69, 1, 30],
                    '2023': [74, -4, 30]
                }
            }
        },
        'Drought': {
            'Non-Iklim': {
                '25': {
                    '2019': [25, 45, 30],
                    '2020': [30, 40, 30],
                    '2021': [35, 35, 30],
                    '2022': [40, 30, 30],
                    '2023': [45, 25, 30]
                },
                '50': {
                    '2019': [30, 40, 30],
                    '2020': [35, 35, 30],
                    '2021': [40, 30, 30],
                    '2022': [45, 25, 30],
                    '2023': [50, 20, 30]
                },
                '100': {
                    '2019': [35, 35, 30],
                    '2020': [40, 30, 30],
                    '2021': [45, 25, 30],
                    '2022': [50, 20, 30],
                    '2023': [55, 15, 30]
                },
                '250': {
                    '2019': [40, 30, 30],
                    '2020': [45, 25, 30],
                    '2021': [50, 20, 30],
                    '2022': [55, 15, 30],
                    '2023': [60, 10, 30]
                }
            },
            'Iklim 4.5': {
                '25': {
                    '2019': [27, 43, 30],
                    '2020': [32, 38, 30],
                    '2021': [37, 33, 30],
                    '2022': [42, 28, 30],
                    '2023': [47, 23, 30]
                },
                '50': {
                    '2019': [32, 38, 30],
                    '2020': [37, 33, 30],
                    '2021': [42, 28, 30],
                    '2022': [47, 23, 30],
                    '2023': [52, 18, 30]
                },
                '100': {
                    '2019': [37, 33, 30],
                    '2020': [42, 28, 30],
                    '2021': [47, 23, 30],
                    '2022': [52, 18, 30],
                    '2023': [57, 13, 30]
                },
                '250': {
                    '2019': [42, 28, 30],
                    '2020': [47, 23, 30],
                    '2021': [52, 18, 30],
                    '2022': [57, 13, 30],
                    '2023': [62, 8, 30]
                }
            },
            'Iklim 8.5': {
                '25': {
                    '2019': [29, 41, 30],
                    '2020': [34, 36, 30],
                    '2021': [39, 31, 30],
                    '2022': [44, 26, 30],
                    '2023': [49, 21, 30]
                },
                '50': {
                    '2019': [34, 36, 30],
                    '2020': [39, 31, 30],
                    '2021': [44, 26, 30],
                    '2022': [49, 21, 30],
                    '2023': [54, 16, 30]
                },
                '100': {
                    '2019': [39, 31, 30],
                    '2020': [44, 26, 30],
                    '2021': [49, 21, 30],
                    '2022': [54, 16, 30],
                    '2023': [59, 11, 30]
                },
                '250': {
                    '2019': [44, 26, 30],
                    '2020': [49, 21, 30],
                    '2021': [54, 16, 30],
                    '2022': [59, 11, 30],
                    '2023': [64, 6, 30]
                }
            }
        }
    },
    'East Java': {
        'Flood': {
            'Non-Iklim': {
                '25': {
                    '2019': [30, 40, 30],
                    '2020': [35, 35, 30],
                    '2021': [40, 30, 30],
                    '2022': [45, 25, 30],
                    '2023': [50, 20, 30]
                },
                '50': {
                    '2019': [35, 35, 30],
                    '2020': [40, 30, 30],
                    '2021': [45, 25, 30],
                    '2022': [50, 20, 30],
                    '2023': [55, 15, 30]
                },
                '100': {
                    '2019': [40, 30, 30],
                    '2020': [45, 25, 30],
                    '2021': [50, 20, 30],
                    '2022': [55, 15, 30],
                    '2023': [60, 10, 30]
                },
                '250': {
                    '2019': [45, 25, 30],
                    '2020': [50, 20, 30],
                    '2021': [55, 15, 30],
                    '2022': [60, 10, 30],
                    '2023': [65, 5, 30]
                }
            },
            'Iklim 4.5': {
                '25': {
                    '2019': [32, 38, 30],
                    '2020': [37, 33, 30],
                    '2021': [42, 28, 30],
                    '2022': [47, 23, 30],
                    '2023': [52, 18, 30]
                },
                '50': {
                    '2019': [37, 33, 30],
                    '2020': [42, 28, 30],
                    '2021': [47, 23, 30],
                    '2022': [52, 18, 30],
                    '2023': [57, 13, 30]
                },
                '100': {
                    '2019': [42, 28, 30],
                    '2020': [47, 23, 30],
                    '2021': [52, 18, 30],
                    '2022': [57, 13, 30],
                    '2023': [62, 8, 30]
                },
                '250': {
                    '2019': [47, 23, 30],
                    '2020': [52, 18, 30],
                    '2021': [57, 13, 30],
                    '2022': [62, 8, 30],
                    '2023': [67, 3, 30]
                }
            },
            'Iklim 8.5': {
                '25': {
                    '2019': [34, 36, 30],
                    '2020': [39, 31, 30],
                    '2021': [44, 26, 30],
                    '2022': [49, 21, 30],
                    '2023': [54, 16, 30]
                },
                '50': {
                    '2019': [39, 31, 30],
                    '2020': [44, 26, 30],
                    '2021': [49, 21, 30],
                    '2022': [54, 16, 30],
                    '2023': [59, 11, 30]
                },
                '100': {
                    '2019': [44, 26, 30],
                    '2020': [49, 21, 30],
                    '2021': [54, 16, 30],
                    '2022': [59, 11, 30],
                    '2023': [64, 6, 30]
                },
                '250': {
                    '2019': [49, 21, 30],
                    '2020': [54, 16, 30],
                    '2021': [59, 11, 30],
                    '2022': [64, 6, 30],
                    '2023': [69, 1, 30]
                }
            }
        },
        'Drought': {
            'Non-Iklim': {
                '25': {
                    '2019': [20, 50, 30],
                    '2020': [25, 45, 30],
                    '2021': [30, 40, 30],
                    '2022': [35, 35, 30],
                    '2023': [40, 30, 30]
                },
                '50': {
                    '2019': [25, 45, 30],
                    '2020': [30, 40, 30],
                    '2021': [35, 35, 30],
                    '2022': [40, 30, 30],
                    '2023': [45, 25, 30]
                },
                '100': {
                    '2019': [30, 40, 30],
                    '2020': [35, 35, 30],
                    '2021': [40, 30, 30],
                    '2022': [45, 25, 30],
                    '2023': [50, 20, 30]
                },
                '250': {
                    '2019': [35, 35, 30],
                    '2020': [40, 30, 30],
                    '2021': [45, 25, 30],
                    '2022': [50, 20, 30],
                    '2023': [55, 15, 30]
                }
            },
            'Iklim 4.5': {
                '25': {
                    '2019': [22, 48, 30],
                    '2020': [27, 43, 30],
                    '2021': [32, 38, 30],
                    '2022': [37, 33, 30],
                    '2023': [42, 28, 30]
                },
                '50': {
                    '2019': [27, 43, 30],
                    '2020': [32, 38, 30],
                    '2021': [37, 33, 30],
                    '2022': [42, 28, 30],
                    '2023': [47, 23, 30]
                },
                '100': {
                    '2019': [32, 38, 30],
                    '2020': [37, 33, 30],
                    '2021': [42, 28, 30],
                    '2022': [47, 23, 30],
                    '2023': [52, 18, 30]
                },
                '250': {
                    '2019': [37, 33, 30],
                    '2020': [42, 28, 30],
                    '2021': [47, 23, 30],
                    '2022': [52, 18, 30],
                    '2023': [57, 13, 30]
                }
            },
            'Iklim 8.5': {
                '25': {
                    '2019': [24, 46, 30],
                    '2020': [29, 41, 30],
                    '2021': [34, 36, 30],
                    '2022': [39, 31, 30],
                    '2023': [44, 26, 30]
                },
                '50': {
                    '2019': [29, 41, 30],
                    '2020': [34, 36, 30],
                    '2021': [39, 31, 30],
                    '2022': [44, 26, 30],
                    '2023': [49, 21, 30]
                },
                '100': {
                    '2019': [34, 36, 30],
                    '2020': [39, 31, 30],
                    '2021': [44, 26, 30],
                    '2022': [49, 21, 30],
                    '2023': [54, 16, 30]
                },
                '250': {
                    '2019': [39, 31, 30],
                    '2020': [44, 26, 30],
                    '2021': [49, 21, 30],
                    '2022': [54, 16, 30],
                    '2023': [59, 11, 30]
                }
            }
        }
    },
    'Yogyakarta': {
        'Flood': {
            'Non-Iklim': {
                '25': {
                    '2019': [25, 45, 30],
                    '2020': [30, 40, 30],
                    '2021': [35, 35, 30],
                    '2022': [40, 30, 30],
                    '2023': [45, 25, 30]
                },
                '50': {
                    '2019': [30, 40, 30],
                    '2020': [35, 35, 30],
                    '2021': [40, 30, 30],
                    '2022': [45, 25, 30],
                    '2023': [50, 20, 30]
                },
                '100': {
                    '2019': [35, 35, 30],
                    '2020': [40, 30, 30],
                    '2021': [45, 25, 30],
                    '2022': [50, 20, 30],
                    '2023': [55, 15, 30]
                },
                '250': {
                    '2019': [40, 30, 30],
                    '2020': [45, 25, 30],
                    '2021': [50, 20, 30],
                    '2022': [55, 15, 30],
                    '2023': [60, 10, 30]
                }
            },
            'Iklim 4.5': {
                '25': {
                    '2019': [27, 43, 30],
                    '2020': [32, 38, 30],
                    '2021': [37, 33, 30],
                    '2022': [42, 28, 30],
                    '2023': [47, 23, 30]
                },
                '50': {
                    '2019': [32, 38, 30],
                    '2020': [37, 33, 30],
                    '2021': [42, 28, 30],
                    '2022': [47, 23, 30],
                    '2023': [52, 18, 30]
                },
                '100': {
                    '2019': [37, 33, 30],
                    '2020': [42, 28, 30],
                    '2021': [47, 23, 30],
                    '2022': [52, 18, 30],
                    '2023': [57, 13, 30]
                },
                '250': {
                    '2019': [42, 28, 30],
                    '2020': [47, 23, 30],
                    '2021': [52, 18, 30],
                    '2022': [57, 13, 30],
                    '2023': [62, 8, 30]
                }
            },
            'Iklim 8.5': {
                '25': {
                    '2019': [29, 41, 30],
                    '2020': [34, 36, 30],
                    '2021': [39, 31, 30],
                    '2022': [44, 26, 30],
                    '2023': [49, 21, 30]
                },
                '50': {
                    '2019': [34, 36, 30],
                    '2020': [39, 31, 30],
                    '2021': [44, 26, 30],
                    '2022': [49, 21, 30],
                    '2023': [54, 16, 30]
                },
                '100': {
                    '2019': [39, 31, 30],
                    '2020': [44, 26, 30],
                    '2021': [49, 21, 30],
                    '2022': [54, 16, 30],
                    '2023': [59, 11, 30]
                },
                '250': {
                    '2019': [44, 26, 30],
                    '2020': [49, 21, 30],
                    '2021': [54, 16, 30],
                    '2022': [59, 11, 30],
                    '2023': [64, 6, 30]
                }
            }
        },
        'Drought': {
            'Non-Iklim': {
                '25': {
                    '2019': [15, 55, 30],
                    '2020': [20, 50, 30],
                    '2021': [25, 45, 30],
                    '2022': [30, 40, 30],
                    '2023': [35, 35, 30]
                },
                '50': {
                    '2019': [20, 50, 30],
                    '2020': [25, 45, 30],
                    '2021': [30, 40, 30],
                    '2022': [35, 35, 30],
                    '2023': [40, 30, 30]
                },
                '100': {
                    '2019': [25, 45, 30],
                    '2020': [30, 40, 30],
                    '2021': [35, 35, 30],
                    '2022': [40, 30, 30],
                    '2023': [45, 25, 30]
                },
                '250': {
                    '2019': [30, 40, 30],
                    '2020': [35, 35, 30],
                    '2021': [40, 30, 30],
                    '2022': [45, 25, 30],
                    '2023': [50, 20, 30]
                }
            },
            'Iklim 4.5': {
                '25': {
                    '2019': [17, 53, 30],
                    '2020': [22, 48, 30],
                    '2021': [27, 43, 30],
                    '2022': [32, 38, 30],
                    '2023': [37, 33, 30]
                },
                '50': {
                    '2019': [22, 48, 30],
                    '2020': [27, 43, 30],
                    '2021': [32, 38, 30],
                    '2022': [37, 33, 30],
                    '2023': [42, 28, 30]
                },
                '100': {
                    '2019': [27, 43, 30],
                    '2020': [32, 38, 30],
                    '2021': [37, 33, 30],
                    '2022': [42, 28, 30],
                    '2023': [47, 23, 30]
                },
                '250': {
                    '2019': [32, 38, 30],
                    '2020': [37, 33, 30],
                    '2021': [42, 28, 30],
                    '2022': [47, 23, 30],
                    '2023': [52, 18, 30]
                }
            },
            'Iklim 8.5': {
                '25': {
                    '2019': [19, 51, 30],
                    '2020': [24, 46, 30],
                    '2021': [29, 41, 30],
                    '2022': [34, 36, 30],
                    '2023': [39, 31, 30]
                },
                '50': {
                    '2019': [24, 46, 30],
                    '2020': [29, 41, 30],
                    '2021': [34, 36, 30],
                    '2022': [39, 31, 30],
                    '2023': [44, 26, 30]
                },
                '100': {
                    '2019': [29, 41, 30],
                    '2020': [34, 36, 30],
                    '2021': [39, 31, 30],
                    '2022': [44, 26, 30],
                    '2023': [49, 21, 30]
                },
                '250': {
                    '2019': [34, 36, 30],
                    '2020': [39, 31, 30],
                    '2021': [44, 26, 30],
                    '2022': [49, 21, 30],
                    '2023': [54, 16, 30]
                }
            }
        }
    }
};

const lineData = {
    'West Java': {
        'Flood, Climate': [12, 18, 25, 32],
        'Drought, Climate': [8, 12, 16, 20],
        'Multi-hazard, Climate': [15, 22, 28, 35],
        'Flood, Non-Climate': [10, 15, 20, 25],
        'Drought, Non-Climate': [6, 9, 12, 15],
        'Multi-hazard, Non-Climate': [13, 19, 24, 30]
    },
    'Central Java': {
        'Flood, Climate': [14, 20, 27, 34],
        'Drought, Climate': [10, 14, 18, 22],
        'Multi-hazard, Climate': [17, 24, 30, 37],
        'Flood, Non-Climate': [12, 17, 22, 27],
        'Drought, Non-Climate': [8, 11, 14, 17],
        'Multi-hazard, Non-Climate': [15, 21, 26, 32]
    },
    'East Java': {
        'Flood, Climate': [16, 22, 29, 36],
        'Drought, Climate': [12, 16, 20, 24],
        'Multi-hazard, Climate': [19, 26, 32, 39],
        'Flood, Non-Climate': [14, 19, 24, 29],
        'Drought, Non-Climate': [10, 13, 16, 19],
        'Multi-hazard, Non-Climate': [17, 23, 28, 34]
    },
    'Yogyakarta': {
        'Flood, Climate': [18, 24, 31, 38],
        'Drought, Climate': [14, 18, 22, 26],
        'Multi-hazard, Climate': [21, 28, 34, 41],
        'Flood, Non-Climate': [16, 21, 26, 31],
        'Drought, Non-Climate': [12, 15, 18, 21],
        'Multi-hazard, Non-Climate': [19, 25, 30, 36]
    }
};

const regionalComparisonData = {
    'West Java': {
        'Flood': {
            'Climate': {
                '25': 120,
                '50': 140,
                '100': 160,
                '250': 180
            },
            'Non-Climate': {
                '25': 100,
                '50': 110,
                '100': 120,
                '250': 130
            }
        },
        'Drought': {
            'Climate': {
                '25': 80,
                '50': 90,
                '100': 100,
                '250': 110
            },
            'Non-Climate': {
                '25': 60,
                '50': 70,
                '100': 80,
                '250': 90
            }
        },
        'Multi-Hazard': {
            'Climate': {
                '25': 200,
                '50': 230,
                '100': 260,
                '250': 290
            },
            'Non-Climate': {
                '25': 160,
                '50': 180,
                '100': 200,
                '250': 220
            }
        }
    },
    'Central Java': {
        'Flood': {
            'Climate': {
                '25': 110,
                '50': 130,
                '100': 150,
                '250': 170
            },
            'Non-Climate': {
                '25': 90,
                '50': 100,
                '100': 110,
                '250': 120
            }
        },
        'Drought': {
            'Climate': {
                '25': 70,
                '50': 80,
                '100': 90,
                '250': 100
            },
            'Non-Climate': {
                '25': 50,
                '50': 60,
                '100': 70,
                '250': 80
            }
        },
        'Multi-Hazard': {
            'Climate': {
                '25': 180,
                '50': 210,
                '100': 240,
                '250': 270
            },
            'Non-Climate': {
                '25': 140,
                '50': 160,
                '100': 180,
                '250': 200
            }
        }
    },
    'East Java': {
        'Flood': {
            'Climate': {
                '25': 100,
                '50': 120,
                '100': 140,
                '250': 160
            },
            'Non-Climate': {
                '25': 80,
                '50': 90,
                '100': 100,
                '250': 110
            }
        },
        'Drought': {
            'Climate': {
                '25': 60,
                '50': 70,
                '100': 80,
                '250': 90
            },
            'Non-Climate': {
                '25': 40,
                '50': 50,
                '100': 60,
                '250': 70
            }
        },
        'Multi-Hazard': {
            'Climate': {
                '25': 160,
                '50': 190,
                '100': 220,
                '250': 250
            },
            'Non-Climate': {
                '25': 120,
                '50': 140,
                '100': 160,
                '250': 180
            }
        }
    },
    'Yogyakarta': {
        'Flood': {
            'Climate': {
                '25': 90,
                '50': 110,
                '100': 130,
                '250': 150
            },
            'Non-Climate': {
                '25': 70,
                '50': 80,
                '100': 90,
                '250': 100
            }
        },
        'Drought': {
            'Climate': {
                '25': 50,
                '50': 60,
                '100': 70,
                '250': 80
            },
            'Non-Climate': {
                '25': 30,
                '50': 40,
                '100': 50,
                '250': 60
            }
        },
        'Multi-Hazard': {
            'Climate': {
                '25': 140,
                '50': 170,
                '100': 200,
                '250': 230
            },
            'Non-Climate': {
                '25': 100,
                '50': 120,
                '100': 140,
                '250': 160
            }
        }
    }
};

// Chart.js integration for data visualization
document.addEventListener('DOMContentLoaded', function() {
    let pieChart, lineChart, barChart;

    // Bar Chart for Loss Distribution
    const lossDistributionCtx = document.getElementById('pieChart');
    if (lossDistributionCtx) {
        const lossDistributionOptions = {
            responsive: true,
            maintainAspectRatio: false,
            animation: {
                duration: 1000,
                easing: 'easeInOutQuad'
            },
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ' - ';
                            }
                            label += context.parsed.y + ' Billion IDR';
                            return label;
                        },
                        title: function(context) {
                            return context[0].label;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Loss (Billion IDR)'
                    }
                },
                x: {
                    title: {
                        display: true,
                        text: 'Return Period and Scenario'
                    },
                    ticks: {
                        maxRotation: 0,
                        minRotation: 0
                    }
                }
            },
            onClick: (event, elements) => {
                if (elements.length > 0) {
                    const element = elements[0];
                    const datasetIndex = element.datasetIndex;
                    const dataIndex = element.index;
                    const label = lossDistributionChart.data.labels[dataIndex];
                    const value = lossDistributionChart.data.datasets[datasetIndex].data[dataIndex];
                    const hazard = lossDistributionChart.data.datasets[datasetIndex].label;
                    alert(`Details for ${hazard} - ${label}: ${value} Billion IDR`);
                }
            },
            onHover: (event, elements) => {
                event.native.target.style.cursor = elements.length > 0 ? 'pointer' : 'default';
            }
        };
        lossDistributionChart = new Chart(lossDistributionCtx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: []
            },
            options: lossDistributionOptions
        });

        // Loss Distribution chart filters
        function updateLossDistributionChart() {
            const selectedRegion = document.getElementById('lossRegionFilter').value;

            const labels = [];
            ['Climate', 'Non-Climate'].forEach(type => {
                ['25', '50', '100', '250'].forEach(rp => {
                    labels.push(`RP${rp} ${type}`);
                });
            });

            const hazardColors = {
                'Flood': '#ff6600',
                'Drought': '#ffcc00',
                'Multi-Hazard': '#00ff00'
            };

            const datasets = ['Flood', 'Drought', 'Multi-Hazard'].map(hazard => {
                const data = [];
                ['Climate', 'Non-Climate'].forEach(type => {
                    ['25', '50', '100', '250'].forEach(rp => {
                        data.push(regionalComparisonData[selectedRegion][hazard][type][rp]);
                    });
                });
                return {
                    label: hazard,
                    data: data,
                    backgroundColor: hazardColors[hazard],
                    borderColor: hazardColors[hazard].replace('ff', 'e5'),
                    borderWidth: 1,
                    hoverBackgroundColor: hazardColors[hazard].replace('ff', 'e5'),
                    hoverBorderColor: hazardColors[hazard].replace('ff', 'cc'),
                    hoverBorderWidth: 2
                };
            });

            lossDistributionChart.data.labels = labels;
            lossDistributionChart.data.datasets = datasets;
            lossDistributionChart.update();
        }

        document.getElementById('lossRegionFilter').addEventListener('change', updateLossDistributionChart);

        // Initialize chart with default data
        updateLossDistributionChart();
    }

    // Line Chart
    const lineCtx = document.getElementById('lineChart');
    if (lineCtx) {
        const colors = ['#ff6600', '#ffcc00', '#00ff00', '#ff0000', '#00ccff', '#cc00ff'];
        const hazardClimate = ['Flood, Climate', 'Drought, Climate', 'Multi-hazard, Climate', 'Flood, Non-Climate', 'Drought, Non-Climate', 'Multi-hazard, Non-Climate'];

        function updateLineChart() {
            const selectedRegion = document.getElementById('lineRegionFilter').value;
            console.log('Updating line chart for region:', selectedRegion);
            const datasets = hazardClimate.map((hc, index) => ({
                label: hc,
                data: lineData[selectedRegion][hc],
                borderColor: colors[index],
                backgroundColor: colors[index].replace('ff', '80'),
                borderWidth: 2,
                pointBackgroundColor: colors[index],
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 5,
                pointHoverRadius: 7,
                tension: 0.4,
                fill: false
            }));
            console.log('Datasets:', datasets);
            lineChart.data.labels = ['RP 25', 'RP 50', 'RP 100', 'RP 250'];
            lineChart.data.datasets = datasets;
            lineChart.update();
        }

        lineChart = new Chart(lineCtx, {
            type: 'line',
            data: {
                labels: ['25', '50', '100', '250'],
                datasets: []
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 1500,
                    easing: 'easeInOutQuad'
                },
                plugins: {
                    legend: {
                        position: 'top',
                        onClick: (e, legendItem, legend) => {
                            const index = legendItem.datasetIndex;
                            const ci = legend.chart;
                            if (ci.isDatasetVisible(index)) {
                                ci.hide(index);
                                legendItem.hidden = true;
                            } else {
                                ci.show(index);
                                legendItem.hidden = false;
                            }
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                label += context.parsed.y + ' Billion IDR';
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Loss (Billion IDR)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Return Period'
                        }
                    }
                },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const element = elements[0];
                        const datasetIndex = element.datasetIndex;
                        const dataIndex = element.index;
                        const label = lineChart.data.labels[dataIndex];
                        const value = lineChart.data.datasets[datasetIndex].data[dataIndex];
                        const datasetLabel = lineChart.data.datasets[datasetIndex].label;
                        alert(`Details for RP ${label} - ${datasetLabel}: ${value} Billion IDR`);
                    }
                },
                onHover: (event, elements) => {
                    event.native.target.style.cursor = elements.length > 0 ? 'pointer' : 'default';
                }
            }
        });

        // Line chart filter
        document.getElementById('lineRegionFilter').addEventListener('change', updateLineChart);

        // Initialize chart with default data
        updateLineChart();
    }

// Bar Chart
    const barCtx = document.getElementById('barChart');
    if (barCtx) {
        const regionColors = {
            'West Java': '#ff6600',
            'Central Java': '#ffcc00',
            'East Java': '#00ff00',
            'Yogyakarta': '#ff0000'
        };
        const regionAbbreviations = {
            'West Java': 'WJ',
            'Central Java': 'CJ',
            'East Java': 'EJ',
            'Yogyakarta': 'YK'
        };

        function updateBarChart() {
            const region1 = document.getElementById('region1Filter').value;
            const region2 = document.getElementById('region2Filter').value;
            const region3 = document.getElementById('region3Filter').value;
            const selectedHazard = document.getElementById('hazardFilter').value;
            const selectedRegions = [region1, region2, region3].filter(r => r && r !== '');

            if (selectedRegions.length === 0) {
                selectedRegions.push('West Java', 'Central Java', 'East Java');
            }

            const labels = [];
            ['Climate', 'Non-Climate'].forEach(type => {
                ['25', '50', '100', '250'].forEach(rp => {
                    labels.push(`RP${rp} ${type}`);
                });
            });

            const datasets = [];
            selectedRegions.forEach(region => {
                const color = regionColors[region];
                const data = [];

                ['Climate', 'Non-Climate'].forEach(type => {
                    ['25', '50', '100', '250'].forEach(rp => {
                        data.push(regionalComparisonData[region][selectedHazard][type][rp]);
                    });
                });

                datasets.push({
                    label: region,
                    data: data,
                    backgroundColor: color,
                    borderColor: color.replace('ff', 'e5'),
                    borderWidth: 1,
                    hoverBackgroundColor: color.replace('ff', 'e5'),
                    hoverBorderColor: color.replace('ff', 'cc'),
                    hoverBorderWidth: 2
                });
            });

            barChart.data.labels = labels;
            barChart.data.datasets = datasets;
            barChart.update();
        }

        barChart = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: []
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 1000,
                    easing: 'easeInOutQuad'
                },
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ' - ';
                                }
                                label += context.parsed.x + ' Billion IDR';
                                return label;
                            },
                            title: function(context) {
                                return context[0].label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Loss (Billion IDR)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Return Period and Scenario'
                        },
                        ticks: {
                            maxRotation: 0,
                            minRotation: 0
                        }
                    }
                },
                onClick: (event, elements) => {
                    if (elements.length > 0) {
                        const element = elements[0];
                        const datasetIndex = element.datasetIndex;
                        const dataIndex = element.index;
                        const label = barChart.data.labels[dataIndex];
                        const value = barChart.data.datasets[datasetIndex].data[dataIndex];
                        const region = barChart.data.datasets[datasetIndex].label;
                        alert(`Details for ${region} - ${label}: ${value} Billion IDR`);
                    }
                },
                onHover: (event, elements) => {
                    event.native.target.style.cursor = elements.length > 0 ? 'pointer' : 'default';
                }
            }
        });

        // Initialize bar chart with correct data
        updateBarChart();

        // Bar chart filters
        document.getElementById('region1Filter').addEventListener('change', updateBarChart);
        document.getElementById('region2Filter').addEventListener('change', updateBarChart);
        document.getElementById('region3Filter').addEventListener('change', updateBarChart);
        document.getElementById('hazardFilter').addEventListener('change', updateBarChart);
    }

    // Table filter
    const tableFilter = document.getElementById('tableLossTypeFilter');
    if (tableFilter) {
        tableFilter.addEventListener('change', function() {
            const selectedType = this.value;
            const table = document.querySelector('table');
            const headers = table.querySelectorAll('th');
            const rows = table.querySelectorAll('tbody tr');

            // Show all columns first
            headers.forEach((th, index) => {
                th.style.display = '';
            });
            rows.forEach(row => {
                row.querySelectorAll('td').forEach((td, index) => {
                    td.style.display = '';
                });
            });

            // Hide columns based on filter
            if (selectedType === 'Flood Loss') {
                headers[2].style.display = 'none'; // Drought Loss
                headers[3].style.display = 'none'; // Total Loss
                rows.forEach(row => {
                    row.cells[2].style.display = 'none';
                    row.cells[3].style.display = 'none';
                });
            } else if (selectedType === 'Drought Loss') {
                headers[1].style.display = 'none'; // Flood Loss
                headers[3].style.display = 'none'; // Total Loss
                rows.forEach(row => {
                    row.cells[1].style.display = 'none';
                    row.cells[3].style.display = 'none';
                });
            } else if (selectedType === 'Total Loss') {
                headers[1].style.display = 'none'; // Flood Loss
                headers[2].style.display = 'none'; // Drought Loss
                rows.forEach(row => {
                    row.cells[1].style.display = 'none';
                    row.cells[2].style.display = 'none';
                });
            }
        });
    }
});



// Report generation functions
function generatePieReport() {
    const region = document.getElementById('pieRegionFilter').value;
    const hazard = 'Flood';
    const year = '2023';

    const reportData = {
        title: 'Loss Distribution Report',
        section: 'Loss Distribution',
        filters: { region, hazard, year },
        data: pieChart.data.datasets[0].data,
        labels: pieChart.data.labels
    };

    generatePDF(reportData);
}

function generateLineReport() {
    const hazard = document.getElementById('lineHazardFilter').value;

    const reportData = {
        title: 'Trend Analysis Report',
        section: 'Trend Analysis',
        filters: { hazard },
        data: lineChart.data.datasets[0].data,
        labels: lineChart.data.labels
    };

    generatePDF(reportData);
}

function generateBarReport() {
    const region1 = document.getElementById('region1Filter').value;
    const region2 = document.getElementById('region2Filter').value;
    const region3 = document.getElementById('region3Filter').value;

    const reportData = {
        title: 'Regional Comparison Report',
        section: 'Regional Comparison',
        filters: { region1, region2, region3 },
        data: barChart.data.datasets,
        labels: barChart.data.labels
    };

    generatePDF(reportData);
}

function generateTableReport() {
    const hazard = document.getElementById('tableHazardFilter').value;

    const reportData = {
        title: 'Data Summary Report',
        section: 'Data Summary',
        filters: { hazard },
        data: Array.from(document.querySelectorAll('table tbody tr')).map(row => Array.from(row.cells).map(cell => cell.textContent))
    };

    generatePDF(reportData);
}

function generatePDF(reportData) {
    // Using jsPDF for PDF generation
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(20);
    doc.text(reportData.title, 20, 30);

    doc.setFontSize(14);
    doc.text(`Section: ${reportData.section}`, 20, 50);

    doc.setFontSize(12);
    let y = 70;
    doc.text('Filters Applied:', 20, y);
    y += 10;
    for (const [key, value] of Object.entries(reportData.filters)) {
        if (value) {
            doc.text(`${key}: ${value}`, 30, y);
            y += 10;
        }
    }

    y += 10;
    doc.text('Data:', 20, y);
    y += 10;

    if (reportData.data && reportData.labels) {
        // Chart data
        reportData.labels.forEach((label, index) => {
            doc.text(`${label}: ${reportData.data[index]}`, 30, y);
            y += 10;
        });
    } else if (reportData.data && Array.isArray(reportData.data)) {
        // Table data
        reportData.data.forEach(row => {
            doc.text(row.join(' | '), 30, y);
            y += 10;
        });
    }

    doc.save(`${reportData.title.replace(/\s+/g, '_')}.pdf`);
}

// Add jsPDF library
const pdfScript = document.createElement('script');
pdfScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
document.head.appendChild(pdfScript);

// Show footer when scrolled to bottom
window.addEventListener('scroll', function() {
    const footer = document.querySelector('footer');
    if (footer) {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        const windowHeight = window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight;

        if (scrollTop + windowHeight >= documentHeight - 10) { // Near bottom
            footer.style.opacity = '1';
        } else {
            footer.style.opacity = '0';
        }
    }
});

// Kabupaten/Kota search functionality
document.addEventListener('DOMContentLoaded', function() {
    const kabupatenSearch = document.getElementById('kabupaten-search');
    if (kabupatenSearch) {
        kabupatenSearch.addEventListener('input', function() {
            const searchValue = this.value.toLowerCase();
            console.log('Searching for:', searchValue);
            // Add logic here to filter map or data based on searchValue
            // For example, zoom to the selected area if GeoJSON has matching features
        });
    }
});
